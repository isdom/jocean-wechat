<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">
        
    <bean id="wxtoken" 
        class="org.jocean.wechat.service.DefaultWXTokenSource"
        destroy-method="start">
        <property name="appid" value="${wechat.appid}"/>
        <property name="secret" value="${wechat.appsecret}"/>
    </bean>
    
    <bean id="wechatOperation" 
        class="org.jocean.wechat.service.WechatOperationFlow"
        destroy-method="stop">
        <property name="appid" value="${wechat.appid}"/>
        <property name="appsecret" value="${wechat.appsecret}"/>
        <property name="maxRetryTimes" value="${wechat.retrytimes:3}"/>
        <property name="retryIntervalBase" value="${wechat.retryintervalbase:2}"/>
    </bean>
    
    <bean factory-bean="eventEngine" 
        factory-method="create">
        <constructor-arg value="wechatOperation"/>
        <constructor-arg>
            <bean factory-bean="wechatOperation"
                factory-method="start"/>
        </constructor-arg>
        <constructor-arg>
            <array>
                <ref bean="wechatOperation"/>
            </array>
        </constructor-arg>
    </bean>

    <!-- bean class="org.jocean.idiom.rx.RxActions"
        factory-method="doPut"
        destroy-method="call">
        <constructor-arg ref="wechatOperations"/>
        <constructor-arg value="${wechat.app}"/>
        <constructor-arg ref="wechatOperation"/>
    </bean -->
</beans>
